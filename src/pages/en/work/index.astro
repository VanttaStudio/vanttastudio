---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "@layouts/BaseLayout.astro";
import Title from "@components/global/Title.astro";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const allProjects = (await getCollection("projects"))
    .filter((project) => {
        const [projectLang] = project.slug.split("/");
        return projectLang === lang;
    })
    .map((project) => {
        const [_, ...slugParts] = project.slug.split("/");
        return { ...project, slug: slugParts.join("/") };
    });

const seo = {
    title: (lang === 'es' ? 'Portafolio' : 'Portfolio') + " | Vantta Studio",
    description: "Digital Portfolio",
};
---

<BaseLayout seo={seo}>
    <section class="bg-zinc-950 text-white min-h-screen">
        <div class="mx-auto px-8 py-24 md:px-12 lg:pt-32 2xl:max-w-7xl">
            
            <header class="mb-24 flex flex-col md:flex-row md:items-end justify-between gap-8">
                <div class="max-w-3xl">
                    <span class="font-mono text-xs uppercase tracking-[0.4em] text-lime-400 mb-4 block">
                        {lang === 'es' ? 'Proyectos Seleccionados' : 'Selected Works'}
                    </span>
                    <Title 
                        title={lang === 'es' ? 'PORTAFOLIO' : 'PORTFOLIO'} 
                        class="text-6xl md:text-8xl lg:text-9xl font-black uppercase tracking-tighter italic" 
                    />
                </div>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-zinc-800 border border-zinc-800 overflow-hidden">
                {allProjects.map((project, index) => {
                    // VALIDACIÃ“N EXTRA PREVENTIVA
                    const hasImage = project.data.image && project.data.image.url;
                    
                    return (
                        <a 
                            href={translatePath(`/work/${project.slug}`)} 
                            class="group relative aspect-square overflow-hidden bg-zinc-900"
                        >
                            <div class="absolute inset-0 transition-transform duration-700 group-hover:scale-105">
                                {hasImage ? (
                                    <Image 
                                        src={project.data.image.url} 
                                        alt={project.data.title || "Vantta Project"}
                                        width={1000}
                                        height={1000}
                                        class="h-full w-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700"
                                    />
                                ) : (
                                    <div class="flex h-full w-full items-center justify-center bg-zinc-900 text-zinc-700 font-mono text-[10px]">
                                        MISSING_ASSET
                                    </div>
                                )}
                                <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 via-zinc-950/20 to-transparent opacity-80 group-hover:opacity-40 transition-opacity duration-500"></div>
                            </div>

                            <div class="absolute inset-0 p-8 md:p-12 flex flex-col justify-between z-10">
                                <div class="flex justify-between items-start opacity-0 group-hover:opacity-100 transition-all duration-500">
                                    <span class="font-mono text-[10px] uppercase tracking-widest bg-white text-black px-2 py-1 font-bold">
                                        {project.data.category || "Case Study"}
                                    </span>
                                    <span class="text-white font-mono text-xs">/0{index + 1}</span>
                                </div>

                                <div class="translate-y-[10px] group-hover:translate-y-0 transition-all duration-500">
                                    <h3 class="text-4xl md:text-6xl font-black uppercase tracking-tighter leading-none italic mb-4">
                                        {project.data.title}
                                    </h3>
                                    <div class="h-1 w-0 bg-lime-400 group-hover:w-20 transition-all duration-500"></div>
                                </div>
                            </div>
                        </a>
                    );
                })}
            </div>
        </div>
    </section>
</BaseLayout>