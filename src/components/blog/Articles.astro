---
import { getCollection } from "astro:content";
import Entry from "@/components/blog/Entry.astro";
import Title from "@components/global/Title.astro";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const allPosts = (await getCollection("posts"))
    .filter((post) => {
        const [postLang, ...slug] = post.slug.split("/");
        return postLang === lang;
    })
    .map((post) => {
        const [postLang, slug] = post.slug.split("/");

        return {
            ...post,
            slug: slug,
        };
    })
    .sort((a, b) => Number(b.data.pubDate) - Number(a.data.pubDate));
---

<section class="relative min-h-screen overflow-hidden bg-zinc-950 text-white">
    <div class="pointer-events-none absolute inset-0 z-0">
        <div class="absolute left-[-10%] top-[-10%] h-[500px] w-[500px] rounded-full bg-lime-400/5 blur-[120px]"></div>
        <div class="absolute right-[-10%] bottom-[-10%] h-[500px] w-[500px] rounded-full bg-violet-600/5 blur-[120px]"></div>
    </div>

    <div class="container relative z-10 mx-auto px-6 py-24 md:px-12 lg:pt-32 2xl:max-w-7xl">
        
        <svg class="hidden" viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg">
            <filter id="article-noise-filter">
                <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"></feTurbulence>
            </filter>
        </svg>

        <header class="mb-20">
            <Title 
                title={t("blog.title")} 
                subtitle={t("blog.subtitle")} 
                class="font-black uppercase tracking-tighter text-6xl md:text-8xl lg:text-9xl" 
            />
        </header>

        {
            allPosts && allPosts[0] && (
                <div class="mb-24 reveal">
                    <div class="mb-8 flex items-center gap-4">
                        <span class="font-mono text-xs uppercase tracking-[0.3em] text-lime-400">Última publicación</span>
                        <div class="h-px flex-1 bg-zinc-800"></div>
                    </div>
                    <Entry
                        url={"/blog/" + allPosts[0].slug}
                        title={allPosts[0].data.title}
                        description={allPosts[0].data.description}
                        alt={allPosts[0].data.title}
                        pubDate={allPosts[0].data.pubDate.toString().slice(4, 15)}
                        author={allPosts[0].data.author}
                        image={allPosts[0].data.image.source}
                        titleInside={true}
                    />
                </div>
            )
        }

        <div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3">
            {
                allPosts
                    .slice(1)
                    .map((post, index) => (
                        <div class="reveal" style={`animation-delay: ${index * 100}ms`}>
                            <Entry
                                url={"/blog/" + post.slug}
                                title={post.data.title}
                                description={post.data.description}
                                alt={post.data.title}
                                pubDate={post.data.pubDate.toString().slice(4, 15)}
                                author={post.data.author}
                                image={post.data.image.source}
                            />
                        </div>
                    ))
            }
        </div>
    </div>
</section>

<style>
    /* Animación de entrada para los posts */
    .reveal {
        opacity: 0;
        animation: fadeInUp 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Asegurar que el título respire */
    header {
        text-wrap: balance;
    }
</style>