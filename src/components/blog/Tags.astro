---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import Title from "@components/global/Title.astro";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const allPosts = (await getCollection("posts"))
    .filter((post) => {
        const [postLang, ...slug] = post.slug.split("/");
        return postLang === lang;
    })
    .map((post) => {
        const [postLang, slug] = post.slug.split("/");

        return {
            ...post,
            slug: slug,
        };
    })
    .sort((a, b) => Number(b.data.pubDate) - Number(a.data.pubDate));

const tags = [...new Set(allPosts.map((post) => post.data.tags).flat())];
---

<section class="bg-zinc-950 text-white">
    <div class="mx-auto px-8 py-24 md:px-12 lg:pt-32 2xl:max-w-7xl">
        <div class="reveal-text">
            <Title 
                class="pb-10 pt-20 uppercase font-black tracking-tighter text-5xl md:text-7xl" 
                title="Explora" 
                subtitle="Categorías de nuestro estudio" 
            />
        </div>
        
        <div class="mt-12">
            <ol class="flex flex-col divide-y divide-zinc-800 border-t border-zinc-800">
                {
                    tags.map((tag) => (
                        <li class="group relative w-full overflow-hidden transition-all duration-500 hover:bg-zinc-900/50">
                            <a 
                                href={translatePath(`/tags/${tag}`)} 
                                class="flex w-full items-center justify-between px-4 py-10 md:px-8"
                                data-cursor-hover
                            >
                                <div class="flex items-center gap-6">
                                    <span class="font-mono text-sm text-zinc-500 group-hover:text-lime-400 transition-colors">
                                        #
                                    </span>
                                    <h3 class="font-display text-2xl font-bold uppercase tracking-tight md:text-4xl text-zinc-300 group-hover:text-white group-hover:translate-x-4 transition-all duration-300">
                                        {tag}
                                    </h3>
                                </div>
                                
                                <div class="relative flex items-center justify-center">
                                    <span class="opacity-0 group-hover:opacity-100 group-hover:translate-x-0 -translate-x-4 transition-all duration-300 text-lime-400">
                                        <Icon name="ic:baseline-arrow-right-alt" width="40" height="40" />
                                    </span>
                                    <span class="absolute font-mono text-xs uppercase tracking-[0.2em] text-zinc-700 group-hover:opacity-0 transition-opacity">
                                        Ver más
                                    </span>
                                </div>
                            </a>
                            
                            <div class="absolute bottom-0 left-0 h-[2px] w-0 bg-lime-400 transition-all duration-500 group-hover:w-full"></div>
                        </li>
                    ))
                }
            </ol>
        </div>
    </div>
</section>

<style>
    /* Estilo para que la tipografía coincida con el resto de Vantta */
    .font-display {
        font-family: var(--font-display, 'Inter', sans-serif);
    }

    /* Animación simple de entrada si no usas GSAP aquí */
    .reveal-text {
        animation: fadeInUp 1s ease forwards;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>