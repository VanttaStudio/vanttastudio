---
---

<div id="cursor-follower" class="pointer-events-none fixed inset-0 z-0">
    <div id="blob" class="blob"></div>
</div>

<script>
    import { gsap } from "gsap";

    function init() {
        const isTouchDevice = window.matchMedia("(hover: none)").matches;
        if (isTouchDevice) return;

        const blob = document.getElementById("blob");
        const follower = document.getElementById("cursor-follower");

        if (!blob || !follower) return;

        // Variables de posición
        let mouseX = 0;
        let mouseY = 0;
        let currentX = 0;
        let currentY = 0;

        // Suavizado (0.1 = muy lento, 1 = instantáneo)
        const lerpFactor = 0.08; 

        // Actualizar coordenadas del ratón
        window.addEventListener("mousemove", (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        // Loop de animación optimizado
        function update() {
            currentX += (mouseX - currentX) * lerpFactor;
            currentY += (mouseY - currentY) * lerpFactor;

            gsap.set(blob, {
                x: currentX,
                y: currentY,
                xPercent: -50,
                yPercent: -50
            });

            requestAnimationFrame(update);
        }

        requestAnimationFrame(update);

        // Interacciones con elementos (Magnetismo y Cambio de tamaño)
        const interactiveElements = document.querySelectorAll("[data-cursor-hover]");

        interactiveElements.forEach((el) => {
            el.addEventListener("mouseenter", () => {
                gsap.to(blob, {
                    scale: 1.5,
                    opacity: 0.4,
                    duration: 0.6,
                    ease: "power2.out"
                });
            });

            el.addEventListener("mouseleave", () => {
                gsap.to(blob, {
                    scale: 0.8,
                    opacity: 0.2,
                    duration: 0.6,
                    ease: "power2.out"
                });

                if (el.hasAttribute("data-cursor-parallax")) {
                    gsap.to(el, { x: 0, y: 0, duration: 0.5, ease: "power2.out" });
                }
            });

            el.addEventListener("mousemove", (e) => {
                if (el.hasAttribute("data-cursor-parallax")) {
                    const rect = el.getBoundingClientRect();
                    const x = (e.clientX - (rect.left + rect.width / 2)) * 0.2;
                    const y = (e.clientY - (rect.top + rect.height / 2)) * 0.2;
                    
                    gsap.to(el, {
                        x: x,
                        y: y,
                        duration: 0.3,
                        ease: "power2.out"
                    });
                }
            });
        });

        follower.classList.add("active");
    }

    // Soporte para transiciones de página de Astro
    document.addEventListener("DOMContentLoaded", init);
    document.addEventListener("astro:page-load", init);
</script>

<style>
    #cursor-follower {
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }

    #cursor-follower.active {
        opacity: 1;
    }

    .blob {
        position: fixed;
        top: 0;
        left: 0;
        width: 400px;
        height: 400px;
        background-color: #a3e635; /* Verde Lima Vantta */
        border-radius: 50%;
        filter: blur(80px);
        opacity: 20%;
        pointer-events: none;
        will-change: transform;
        z-index: -1;
        transform: scale(0.8);
    }
</style>