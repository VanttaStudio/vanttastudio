---
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const { class: className } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

// Definimos la lista de FAQs. 
// TIP: Si decides reducir el número de preguntas, solo borra los objetos de este array.
const faqs = [
    { question: t("faqs.question1"), answer: t("faqs.answer1") },
    { question: t("faqs.question2"), answer: t("faqs.answer2") },
    { question: t("faqs.question3"), answer: t("faqs.answer3") },
    { question: t("faqs.question4"), answer: t("faqs.answer4") },
    { question: t("faqs.question5"), answer: t("faqs.answer5") },
    { question: t("faqs.question6"), answer: t("faqs.answer6") },
];
---

<section id="faq" class:list={["section faq-section relative bg-zinc-950 text-white", className]}>
    <div class="wrapper col-span-12 flex min-h-screen w-full flex-col py-32 md:flex-row px-6 md:px-12">
        <div class="title-container top-0 pt-10 md:sticky md:h-[30rem] md:w-1/3">
            <h2 class="font-display text-6xl md:text-7xl lg:text-9xl font-bold tracking-tighter">FAQ</h2>
            <p class="mt-4 text-zinc-500 font-mono text-sm uppercase">{t("faq.subtitle") || "Preguntas Frecuentes"}</p>
        </div>
        
        <div class="faq-list flex grow flex-col items-stretch px-0 pt-10 md:px-10 lg:px-20 md:w-2/3">
            <div class="hidden">
                <svg xmlns="http://www.w3.org/2000/svg">
                    <symbol viewBox="0 0 24 24" id="expand-more">
                        <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path>
                    </symbol>
                    <symbol viewBox="0 0 24 24" id="close">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
                    </symbol>
                </svg>
            </div>

            {
                faqs.map(({ question, answer }) => (
                    <details class="group relative min-h-1 grow rounded-lg border border-zinc-800 bg-zinc-900/50 mb-4 transition-all hover:bg-zinc-900">
                        <summary class="flex justify-between items-center gap-4 px-8 py-8 cursor-pointer list-none">
                            <span class="text-lg md:text-xl font-medium tracking-tight">{question}</span>
                            <div class="relative w-6 h-6">
                                <svg class="absolute inset-0 transition-transform duration-300 group-open:rotate-180 fill-current" width="24" height="24">
                                    <use xlink:href="#expand-more" />
                                </svg>
                            </div>
                        </summary>
                        <div class="px-8 pb-8 font-light text-zinc-400 leading-relaxed text-base md:text-lg">
                            <p set:html={answer} />
                        </div>
                    </details>
                ))
            }
        </div>
    </div>

    <div class="faq-more-questions col-span-12 flex flex-col items-center justify-center gap-8 pb-32">
        <div class="flex flex-col md:flex-row items-center gap-10">
            <span class="other-question-title opacity-0 font-display text-2xl uppercase tracking-widest">{t("faq.otherquestions")}</span>
            <svg
                fill="transparent"
                stroke="currentColor"
                stroke-width="20px"
                class="text-blue-500"
                width="60"
                height="60"
                viewBox="0 0 800 800">
                <path
                    id="faq-more-question-path"
                    d="M779.3,519.1c-16.3,0-31,0-47.3-1.6c62-154.9,101.1-415.9-112.5-458.3C569,47.8,520,54.3,485.8,82
        c-58.7-35.9-132.1-53.8-195.7-45.7c-42.4,4.9-71.8,32.6-89.7,68.5c-39.1-13-81.5-17.9-110.9-4.9C-21.4,147.3-29.5,294,66.7,362.5
        c9.8,6.5,17.9-6.5,11.4-14.7C-1.8,259.8,40.6,82,180.8,139.1c1.6,1.6,4.9,1.6,6.5,3.3c-11.4,44-8.2,94.6,11.4,130.5
        c42.4,78.3,145.1,26.1,125.6-53.8c-9.8-37.5-45.7-73.4-89.7-96.2c13-26.1,34.2-45.7,70.1-47.3c48.9-1.6,99.5,9.8,141.9,34.2
        c4.9,3.3,8.2,4.9,13,8.2c-4.9,11.4-9.8,24.5-13,39.1c-9.8,48.9,1.6,146.8,55.4,171.2c66.9,29.4,102.7-75,84.8-123.9
        c-13-37.5-39.1-70.1-70.1-96.2c13-9.8,31-14.7,53.8-13c225,16.3,177.8,274,119.1,422.4c-16.3-1.6-34.2-4.9-52.2-6.5
        c-3.3,0-6.5,0-8.2,1.6c-9.8-8.2-27.7-4.9-27.7,11.4c-3.3,71.8,21.2,156.6,40.8,226.7c4.9,16.3,31,21.2,39.1,4.9
        c35.9-70.1,76.6-135.4,115.8-203.8C805.4,538.7,794,519.1,779.3,519.1z">
                </path>
            </svg>
        </div>
        <div class="faq-contact-us-button rounded-full bg-white px-10 py-4 opacity-0 transition-transform hover:scale-105" data-cursor-hover>
            <a
                class="text-xl text-zinc-950 font-bold uppercase tracking-tight"
                href={translatePath("/contact/")}>
                {t("contactus")}
            </a>
        </div>
    </div>
</section>

<style>
    summary::-webkit-details-marker { display: none; }
    
    .faq-section {
        --faq-clip: 0;
        --faq-radius: 0;
        clip-path: inset(var(--faq-clip) round var(--faq-radius));
    }
</style>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";

    gsap.registerPlugin(ScrollTrigger, DrawSVGPlugin);

    function initFaq() {
        // Efecto de redondeado de la sección al salir
        gsap.to("#faq", {
            scrollTrigger: {
                trigger: "#faq",
                start: "bottom center",
                end: "bottom top",
                scrub: 1,
            },
            "--faq-clip": "2vw",
            "--faq-radius": "5rem",
        });

        const linePath = document.querySelector("#faq-more-question-path");
        if (linePath) {
            gsap.set(linePath, { drawSVG: 0 });

            gsap.timeline({
                scrollTrigger: {
                    trigger: ".faq-more-questions",
                    start: "center 90%",
                    end: "center 40%",
                    scrub: 1,
                },
            })
            .to(".other-question-title", { opacity: 1, duration: 0.5 })
            .to(linePath, { drawSVG: "100%", duration: 2 }, "<")
            .to(".faq-contact-us-button", { opacity: 1, y: -20 }, "-=0.5");
        }
    }

    document.addEventListener("astro:page-load", initFaq);
    initFaq();
</script>